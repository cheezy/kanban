# Stride Integration - Aider Configuration

main-system-message: |
  You are working with the Stride task management system. Stride enforces workflow discipline through four client-side hooks:

  - before_doing (60s, blocking) - Execute before starting work
  - after_doing (120s, blocking) - Execute after work, BEFORE calling complete endpoint
  - before_review (60s, non-blocking) - Execute when entering review
  - after_review (60s, non-blocking) - Execute after approval

  CRITICAL: Always execute the after_doing hook BEFORE calling the task completion endpoint.

conventions:
  identifiers:
    rule: "Never specify identifiers when creating tasks"
    reason: "Identifiers are auto-generated (G1, W47, D12)"
    bad_example: '{"identifier": "W47", "title": "Add dark mode"}'
    good_example: '{"title": "Add dark mode", "type": "work"}'

  verification_steps:
    rule: "Must be array of objects, not strings"
    reason: "Each step needs step_type, step_text, expected_result, position"
    bad_example: '["Run mix test", "Check coverage"]'
    good_example: '[{"step_type": "command", "step_text": "mix test path/to/test.exs", "expected_result": "All tests pass", "position": 0}]'

  testing_strategy:
    rule: "unit_tests, integration_tests, manual_tests must be arrays"
    reason: "System expects array format for all test types"
    bad_example: '{"unit_tests": "Test the auth flow"}'
    good_example: '{"unit_tests": ["Test JWT generation", "Test token validation"]}'

  task_type:
    rule: "type must be exactly 'work', 'defect', or 'goal'"
    reason: "These are the only valid task types"
    bad_example: '{"type": "task"}'
    good_example: '{"type": "work"}'

  completion_order:
    rule: "Execute after_doing hook BEFORE calling complete endpoint"
    reason: "Hook validation failures must prevent task completion"
    correct_sequence:
      - "Finish work"
      - "Execute after_doing hook (tests, lint, build)"
      - "Only if hook succeeds, call PATCH /api/tasks/:id/complete"
      - "Execute before_review hook (non-blocking)"

required_fields:
  minimal:
    - "type: Exactly 'work', 'defect', or 'goal'"
    - "title: Clear, specific description"

  critical:
    - "key_files: Prevents merge conflicts"
    - "dependencies: Controls execution order"
    - "verification_steps: Array of objects"
    - "testing_strategy: Must have arrays for unit/integration/manual tests"

  recommended:
    - "description: WHY this matters and WHAT needs to be done"
    - "complexity: 'small', 'medium', or 'large'"
    - "priority: 'low', 'medium', 'high', or 'critical'"
    - "needs_review: Boolean controlling review requirement"
    - "pitfalls: Array of what NOT to do"
    - "patterns_to_follow: Code patterns to replicate"
    - "acceptance_criteria: Definition of done"

workflows:
  claiming:
    steps:
      - "GET /api/tasks/next - Find available task"
      - "POST /api/tasks/claim - Claim task (returns before_doing hook)"
      - "Execute before_doing hook with 60s timeout"
      - "Check exit code (blocking hook must succeed)"
      - "Begin work"

  completing:
    steps:
      - "Finish implementation"
      - "Execute after_doing hook FIRST (120s timeout)"
      - "Check exit code - if non-zero, fix issues"
      - "Only if hook succeeds: PATCH /api/tasks/:id/complete"
      - "Execute before_review hook (non-blocking)"

  creating_task:
    minimal_example: |
      {
        "type": "work",
        "title": "Add JWT authentication to API",
        "complexity": "medium",
        "priority": "high"
      }

    complete_example: |
      {
        "type": "work",
        "title": "Add JWT authentication to API",
        "description": "Implement JWT token-based authentication to secure API endpoints",
        "complexity": "medium",
        "priority": "high",
        "needs_review": true,
        "key_files": [
          {"file_path": "lib/myapp_web/plugs/auth.ex", "note": "New JWT plug", "position": 0}
        ],
        "verification_steps": [
          {
            "step_type": "command",
            "step_text": "mix test test/myapp_web/plugs/auth_test.exs",
            "expected_result": "All auth tests pass",
            "position": 0
          }
        ],
        "testing_strategy": {
          "unit_tests": ["Test JWT generation", "Test token validation"],
          "integration_tests": ["Full auth flow"],
          "manual_tests": ["Verify API rejects invalid tokens"],
          "edge_cases": ["Expired tokens", "Malformed tokens"],
          "coverage_target": "100% for auth module"
        },
        "pitfalls": ["Don't skip token expiration validation"],
        "patterns_to_follow": "Follow Guardian library patterns",
        "acceptance_criteria": "API requires valid JWT\nInvalid tokens return 401"
      }

  creating_goal:
    example: |
      {
        "type": "goal",
        "title": "User Authentication System",
        "complexity": "large",
        "tasks": [
          {
            "type": "work",
            "title": "Add JWT library",
            "complexity": "small"
          },
          {
            "type": "work",
            "title": "Create auth endpoints",
            "complexity": "medium",
            "dependencies": [0]
          }
        ]
      }

  batch_creation:
    note: "Root key must be 'goals' (not 'tasks')"
    example: |
      {
        "goals": [
          {
            "type": "goal",
            "title": "Authentication System",
            "tasks": [...]
          },
          {
            "type": "goal",
            "title": "User Profile Management",
            "tasks": [...]
          }
        ]
      }

hook_environment_variables:
  - "TASK_ID: Numeric task ID"
  - "TASK_IDENTIFIER: Human-readable ID (W47, G10, D5)"
  - "TASK_TITLE: Task title"
  - "TASK_STATUS: Current status"
  - "TASK_COMPLEXITY: small/medium/large"
  - "TASK_PRIORITY: low/medium/high/critical"
  - "BOARD_ID: Board numeric ID"
  - "BOARD_NAME: Board name"
  - "AGENT_NAME: Your agent/developer name"
  - "HOOK_NAME: Which hook is executing"

documentation:
  onboarding: "https://www.stridelikeaboss.com/api/agent/onboarding"
  task_writing: "https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/TASK-WRITING-GUIDE.md"
  api_reference: "https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/api/README.md"
  hook_execution: "https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/AGENT-HOOK-EXECUTION-GUIDE.md"
  ai_workflow: "https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/AI-WORKFLOW.md"

note: |
  These instructions provide essential guidance for code completion. For comprehensive workflow enforcement,
  Claude Code users should install the four Stride Skills from the onboarding endpoint.
