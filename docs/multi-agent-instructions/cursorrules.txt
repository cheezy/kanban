Stride Integration - Cursor Rules

HOOK EXECUTION (MANDATORY)

Stride enforces workflow discipline through four client-side hooks that execute on the developer's machine:

- before_doing (60s, blocking) - Execute before starting work (pull code, setup)
- after_doing (120s, blocking) - Execute after work, BEFORE calling complete endpoint (tests, lint)
- before_review (60s, non-blocking) - Execute when entering review (create PR, docs)
- after_review (60s, non-blocking) - Execute after approval (merge, deploy)

CRITICAL: Always execute the after_doing hook BEFORE calling the task completion endpoint. Hook validation failures must prevent task completion.

TOP 5 CRITICAL MISTAKES

1. Specifying Identifiers When Creating Tasks

DON'T DO THIS:
{
  "identifier": "W47",
  "title": "Add dark mode",
  "type": "work"
}

DO THIS:
{
  "title": "Add dark mode",
  "type": "work"
}

WHY: Identifiers are auto-generated by the system (G1, W47, D12). Specifying them causes API rejection.

2. Using String Arrays for verification_steps

DON'T DO THIS:
{
  "verification_steps": [
    "Run mix test",
    "Check coverage"
  ]
}

DO THIS:
{
  "verification_steps": [
    {
      "step_type": "command",
      "step_text": "mix test path/to/test.exs",
      "expected_result": "All tests pass",
      "position": 0
    }
  ]
}

WHY: verification_steps must be array of objects with step_type, step_text, expected_result, and position.

3. Using Non-Array Values for testing_strategy Fields

DON'T DO THIS:
{
  "testing_strategy": {
    "unit_tests": "Test the auth flow",
    "integration_tests": "Test end-to-end",
    "manual_tests": "Click the button"
  }
}

DO THIS:
{
  "testing_strategy": {
    "unit_tests": ["Test JWT generation", "Test token validation"],
    "integration_tests": ["Full auth flow with database"],
    "manual_tests": ["Verify login form works"],
    "edge_cases": ["Expired tokens", "Invalid credentials"],
    "coverage_target": "100% for auth module"
  }
}

WHY: unit_tests, integration_tests, and manual_tests must be arrays of strings.

4. Using Wrong Type Values

DON'T DO THIS:
{
  "type": "task"
}

DO THIS:
{
  "type": "work"
}

WHY: type must be exactly "work", "defect", or "goal" as strings.

5. Calling Complete Endpoint Before Executing after_doing Hook

DON'T DO THIS:
1. Finish work
2. Call PATCH /api/tasks/:id/complete
3. Execute after_doing hook

DO THIS:
1. Finish work
2. Execute after_doing hook (tests, lint, build)
3. Only if hook succeeds, call PATCH /api/tasks/:id/complete

WHY: Hook validation failures must prevent task completion. Calling complete first bypasses quality gates.

ESSENTIAL TASK FIELDS

Required:
- type - Exactly "work", "defect", or "goal"
- title - Clear, specific description

Critical:
- key_files - Prevents merge conflicts
- dependencies - Controls execution order
- verification_steps - Array of objects
- testing_strategy - Must have arrays for unit/integration/manual tests

Strongly Recommended:
- description - WHY this matters and WHAT needs to be done
- complexity - "small", "medium", or "large"
- priority - "low", "medium", "high", or "critical"
- needs_review - Boolean controlling review requirement
- pitfalls - Array of what NOT to do
- patterns_to_follow - Code patterns to replicate
- acceptance_criteria - Definition of done
- why - Problem/value explanation
- what - Specific change description
- where_context - Location in code/UI

CODE PATTERN: Claiming a Task

# 1. Find available task
curl -H "Authorization: Bearer $TOKEN" \
  https://www.stridelikeaboss.com/api/tasks/next

# 2. Claim task (returns before_doing hook)
curl -X POST \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"task_id": 123, "agent_name": "Your Name"}' \
  https://www.stridelikeaboss.com/api/tasks/claim

Response includes:
{
  "task": {...},
  "hook": {
    "name": "before_doing",
    "command": "git pull origin main && mix deps.get",
    "timeout": 60000,
    "blocking": true,
    "env": {
      "TASK_ID": "123",
      "TASK_IDENTIFIER": "W47",
      "TASK_TITLE": "Add dark mode",
      ...
    }
  }
}

# 3. Execute before_doing hook
# Set environment variables from hook.env
# Execute hook.command with timeout
# Check exit code (blocking hook must succeed)

# 4. Begin work

CODE PATTERN: Completing a Task

# 1. Finish implementation

# 2. Execute after_doing hook FIRST
# Parse hook metadata from .stride.md
# Set environment variables
# Execute hook command with 120s timeout
# Check exit code - if non-zero, stop here and fix issues

# 3. Only if hook succeeds, call complete endpoint
curl -X PATCH \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "agent_name": "Your Name",
    "time_spent_minutes": 45,
    "completion_notes": "Implemented feature X. All tests passing."
  }' \
  https://www.stridelikeaboss.com/api/tasks/123/complete

Response includes before_review, after_doing, and after_review hooks

# 4. Execute before_review hook (non-blocking)
# Continue even if it fails

CODE PATTERN: Creating a Simple Task

{
  "type": "work",
  "title": "Add JWT authentication to API",
  "description": "Implement JWT token-based authentication to secure API endpoints. Currently using basic auth which is insecure.",
  "why": "Current basic auth is vulnerable to credential theft. JWT provides stateless, secure authentication.",
  "what": "Replace basic auth middleware with JWT verification plug. Add token generation to login endpoint.",
  "where_context": "lib/myapp_web/plugs/auth.ex and lib/myapp_web/controllers/session_controller.ex",
  "complexity": "medium",
  "priority": "high",
  "needs_review": true,
  "key_files": [
    {
      "file_path": "lib/myapp_web/plugs/auth.ex",
      "note": "New JWT authentication plug",
      "position": 0
    },
    {
      "file_path": "lib/myapp_web/controllers/session_controller.ex",
      "note": "Add token generation on login",
      "position": 1
    }
  ],
  "verification_steps": [
    {
      "step_type": "command",
      "step_text": "mix test test/myapp_web/plugs/auth_test.exs",
      "expected_result": "All auth tests pass",
      "position": 0
    },
    {
      "step_type": "command",
      "step_text": "mix test test/myapp_web/controllers/session_controller_test.exs",
      "expected_result": "Session controller tests pass",
      "position": 1
    }
  ],
  "testing_strategy": {
    "unit_tests": [
      "Test JWT generation with valid credentials",
      "Test token validation with valid token",
      "Test token validation with expired token",
      "Test token validation with malformed token"
    ],
    "integration_tests": [
      "Test protected endpoint access with valid token",
      "Test protected endpoint rejects missing token",
      "Test protected endpoint rejects invalid token"
    ],
    "manual_tests": [
      "Verify API returns 401 without token",
      "Verify API accepts valid token",
      "Verify token refresh works"
    ],
    "edge_cases": [
      "Malformed tokens",
      "Missing signature",
      "Expired tokens",
      "Tokens from different environment"
    ],
    "coverage_target": "100% for auth module"
  },
  "pitfalls": [
    "Don't store tokens in localStorage without encryption",
    "Don't skip token expiration validation",
    "Don't use weak signing keys",
    "Don't expose secret keys in logs"
  ],
  "patterns_to_follow": "Follow Guardian library patterns from existing sessions controller. Use same error handling approach as other plugs.",
  "acceptance_criteria": "API endpoints require valid JWT token\nToken refresh works correctly\nInvalid tokens return 401\nExpired tokens return 401\nToken payload includes user_id and permissions"
}

CODE PATTERN: Creating a Goal with Nested Tasks

{
  "type": "goal",
  "title": "User Authentication System",
  "description": "Complete authentication system with login, registration, password reset, and session management",
  "complexity": "large",
  "priority": "high",
  "tasks": [
    {
      "type": "work",
      "title": "Add JWT library and configuration",
      "description": "Install Guardian library and configure JWT settings",
      "complexity": "small",
      "priority": "high",
      "key_files": [
        {
          "file_path": "mix.exs",
          "note": "Add guardian dependency",
          "position": 0
        },
        {
          "file_path": "config/config.exs",
          "note": "Add Guardian configuration",
          "position": 1
        }
      ],
      "verification_steps": [
        {
          "step_type": "command",
          "step_text": "mix deps.get && mix compile",
          "expected_result": "Guardian dependency compiles without errors",
          "position": 0
        }
      ],
      "testing_strategy": {
        "unit_tests": ["Test config loads correctly"],
        "integration_tests": [],
        "manual_tests": ["Verify Guardian module available in IEx"]
      }
    },
    {
      "type": "work",
      "title": "Create authentication endpoints",
      "description": "Build login and logout endpoints with JWT token generation",
      "complexity": "medium",
      "priority": "high",
      "dependencies": [0],
      "key_files": [
        {
          "file_path": "lib/myapp_web/controllers/session_controller.ex",
          "note": "Login/logout endpoints",
          "position": 0
        }
      ],
      "verification_steps": [
        {
          "step_type": "command",
          "step_text": "mix test test/myapp_web/controllers/session_controller_test.exs",
          "expected_result": "All auth endpoint tests pass",
          "position": 0
        }
      ],
      "testing_strategy": {
        "unit_tests": [
          "Test login with valid credentials",
          "Test login with invalid credentials",
          "Test logout clears session"
        ],
        "integration_tests": [
          "Full auth flow from login to protected resource access"
        ],
        "manual_tests": [
          "Verify endpoints work in Postman",
          "Verify token format is correct"
        ]
      }
    },
    {
      "type": "work",
      "title": "Create authentication plug",
      "description": "Build middleware to verify JWT tokens on protected routes",
      "complexity": "medium",
      "priority": "high",
      "dependencies": [1],
      "key_files": [
        {
          "file_path": "lib/myapp_web/plugs/require_auth.ex",
          "note": "JWT verification plug",
          "position": 0
        }
      ],
      "verification_steps": [
        {
          "step_type": "command",
          "step_text": "mix test test/myapp_web/plugs/require_auth_test.exs",
          "expected_result": "All plug tests pass",
          "position": 0
        }
      ],
      "testing_strategy": {
        "unit_tests": [
          "Test plug accepts valid token",
          "Test plug rejects missing token",
          "Test plug rejects invalid token",
          "Test plug rejects expired token"
        ],
        "integration_tests": [
          "Test protected route requires authentication"
        ],
        "manual_tests": []
      }
    }
  ]
}

CODE PATTERN: Batch Creating Multiple Goals

{
  "goals": [
    {
      "type": "goal",
      "title": "Authentication System",
      "description": "JWT-based authentication with login, logout, and protected routes",
      "complexity": "large",
      "priority": "high",
      "tasks": [
        {
          "type": "work",
          "title": "Add JWT library",
          "complexity": "small",
          "priority": "high"
        },
        {
          "type": "work",
          "title": "Create auth endpoints",
          "complexity": "medium",
          "priority": "high",
          "dependencies": [0]
        },
        {
          "type": "work",
          "title": "Create auth plug",
          "complexity": "medium",
          "priority": "high",
          "dependencies": [1]
        }
      ]
    },
    {
      "type": "goal",
      "title": "User Profile Management",
      "description": "User profile CRUD operations and settings",
      "complexity": "large",
      "priority": "medium",
      "tasks": [
        {
          "type": "work",
          "title": "Profile schema migration",
          "complexity": "small",
          "priority": "medium"
        },
        {
          "type": "work",
          "title": "Profile endpoints",
          "complexity": "medium",
          "priority": "medium",
          "dependencies": [0]
        }
      ]
    }
  ]
}

CRITICAL: Root key must be "goals" (not "tasks"). Dependencies within goals use array indices [0, 1]. Cross-goal dependencies don't work in batch - create goals separately.

HOOK ENVIRONMENT VARIABLES

When hooks execute, these environment variables are available:

- TASK_ID - Numeric task ID (e.g., "123")
- TASK_IDENTIFIER - Human-readable ID (e.g., "W47", "G10", "D5")
- TASK_TITLE - Task title
- TASK_DESCRIPTION - Full task description
- TASK_STATUS - Current status (e.g., "doing", "review", "done")
- TASK_COMPLEXITY - "small", "medium", or "large"
- TASK_PRIORITY - "low", "medium", "high", or "critical"
- TASK_NEEDS_REVIEW - "true" or "false"
- BOARD_ID - Board numeric ID
- BOARD_NAME - Board name
- COLUMN_ID - Column numeric ID
- COLUMN_NAME - Column name (e.g., "Doing", "Review")
- AGENT_NAME - Your agent/developer name
- HOOK_NAME - Which hook is executing (e.g., "before_doing")

DEPENDENCY HANDLING

Within Goals (using array indices):
{
  "type": "goal",
  "tasks": [
    {"title": "Task A", "type": "work"},
    {"title": "Task B", "type": "work", "dependencies": [0]},
    {"title": "Task C", "type": "work", "dependencies": [0, 1]}
  ]
}

For Standalone Tasks (using identifiers):
{
  "title": "New task",
  "type": "work",
  "dependencies": ["W47", "W48"]
}

Cross-Goal Dependencies:
Cannot be specified in batch creation. Create goals separately, then PATCH to add dependencies.

COMMON ANTI-PATTERNS

1. Minimal Task Descriptions
BAD: "Fix the login bug"
GOOD: "Fix login bug where expired JWT tokens cause 500 error instead of 401. Occurs in RequireAuth plug when token.exp < current_time. Should return proper 401 with error message."

2. Missing key_files
This causes merge conflicts when multiple agents work on same files.

3. String-based verification_steps
Always use object format with step_type, step_text, expected_result, position.

4. Non-array testing_strategy fields
unit_tests, integration_tests, manual_tests MUST be arrays.

5. Skipping Hook Execution
Hooks enforce quality standards. Don't skip them.

6. Wrong Completion Order
Always: work → after_doing hook → complete endpoint → before_review hook

DOCUMENTATION LINKS

- Onboarding: https://www.stridelikeaboss.com/api/agent/onboarding
- Task Writing Guide: https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/TASK-WRITING-GUIDE.md
- API Reference: https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/api/README.md
- Hook Execution: https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/AGENT-HOOK-EXECUTION-GUIDE.md
- AI Workflow: https://raw.githubusercontent.com/cheezy/kanban/refs/heads/main/docs/AI-WORKFLOW.md

NOTE

These instructions provide essential guidance for code completion. For comprehensive workflow enforcement, Claude Code users should install the four Stride Skills from the onboarding endpoint.
